@using JxAudio.Front.Data
@using JxAudio.TransVo
@inject IDispatchService<AddTrackMessage> DispatchService

<Table TItem="TrackVo" Items="Tracks" IsBordered="true" IsStriped="true" ShowExtendButtons="true" 
       ShowExtendEditButton="false" ShowExtendDeleteButton="false">
    <TableColumns>
        <TableColumn @bind-Field="@context.Title"></TableColumn>
        <TableColumn @bind-Field="@context.Artists">
            <Template Context="value">
                @if (value.Value != null)
                {
                    @foreach (var artist in value.Value)
                    {
                        <LinkButton Url="@($"/Artist/{artist.Id}")">@artist.Name</LinkButton>
                        @:&nbsp;
                    }
                }
            </Template>
        </TableColumn>
        <TableColumn @bind-Field="@context.Name" Text="音频格式">
            <Template Context="value">
                @Path.GetExtension(value.Value!)[1..].ToUpper()
            </Template>
        </TableColumn>
        <TableColumn @bind-Field="@context.BitRate"></TableColumn>
        <TableColumn @bind-Field="@context.Size">
            <Template Context="value">
                @value.Value.ToFileSizeString()
            </Template>
        </TableColumn>
    </TableColumns>
    <RowButtonTemplate>
        <TableCellButton Icon="fa fa-play" OnClick="() => Play(context)"></TableCellButton>
        <TableCellButton Icon="fa fa-plus" OnClick="() => AddToList(context)"></TableCellButton>
    </RowButtonTemplate>
</Table>

@code {
    [Parameter]
    public List<TrackVo>? Tracks { get; set; }

    private void Play(TrackVo trackVo)
    {
        DispatchService.Dispatch(new DispatchEntry<AddTrackMessage>()
        {
            Entry = new AddTrackMessage()
            {
                Tracks = [trackVo],
                Type = "replace"
            }
        });
    }

    private void AddToList(TrackVo trackVo)
    {
        DispatchService.Dispatch(new DispatchEntry<AddTrackMessage>()
        {
            Entry = new AddTrackMessage()
            {
                Tracks = [trackVo],
                Type = "add"
            }
        });
    }

}